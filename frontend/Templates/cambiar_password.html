{% extends 'base.html' %}
{% block title %}Cambiar Contraseña - SAE{% endblock %}
{% block content %}
<div class="container auth-box">
  <h2>Cambiar Contraseña</h2>
  <form id="form-cambiar-pass">
    <label>Contraseña actual</label>
  <input type="password" name="current_password" required minlength="8" class="input-form" placeholder="Ingresa tu contraseña actual" title="Ingresa tu contraseña actual">
    <label>Nueva contraseña</label>
  <input type="password" name="new_password" required minlength="8" class="input-form" placeholder="Nueva contraseña" title="Nueva contraseña">
    <label>Repite nueva contraseña</label>
  <input type="password" name="new_password2" required minlength="8" class="input-form" placeholder="Repite la nueva contraseña" title="Repite la nueva contraseña">
    <button type="submit" class="btn-primary">Actualizar</button>
  </form>
  <div id="resultado" class="resultado"></div>
  <div class="acciones-secundarias">
    <a href="/mod_principal">Volver al panel</a>
  </div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script>
const formCambiar = document.getElementById('form-cambiar-pass');
formCambiar.addEventListener('submit', async (e) => {
  e.preventDefault();
  const fd = new FormData(formCambiar);
  document.getElementById('resultado').innerHTML = '<p>Procesando...</p>';
  const resp = await fetch('/recuperacion/cambiar', { method: 'POST', body: fd });
  const data = await resp.json();
  if (resp.ok) {
    document.getElementById('resultado').innerHTML = `<p class='ok'>${data.mensaje}</p>`;
    formCambiar.reset();
  } else {
    document.getElementById('resultado').innerHTML = `<p class='error'>${data.mensaje}</p>`;
  }
});
</script>
{% endblock %}
